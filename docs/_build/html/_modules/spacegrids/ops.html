<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>spacegrids.ops &mdash; spacegrids  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="spacegrids  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">spacegrids  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for spacegrids.ops</h1><div class="highlight"><pre>
<span class="c">#encoding:utf-8</span>

<span class="sd">&quot;&quot;&quot; Mathematical operators based on Field and Gr operations.</span>

<span class="sd">The mathematical operators defined here, such as Der, provide basic building blocks for the user to define more detailed Operators. Arithmatic operations such as addition and multiplication among these operators yield new operators. These new operators can be called on Field objects later, performing the intended operation. </span>

<span class="sd">Example:</span>

<span class="sd">  &gt;&gt;&gt; ddX = sg.Der(X) # create Operator that would take X-derivative on Field args</span>
<span class="sd">  &gt;&gt;&gt; ddY = sg.Der(Y) # similar</span>
<span class="sd">  &gt;&gt;&gt; ddXddY = ddX*ddY  # create composite operator</span>
<span class="sd">  &gt;&gt;&gt; ddXddY(F) # differentiation in X direction following differentiation in Y</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">_config</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">fieldcls</span> <span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="Operator"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Operator">[docs]</a><span class="k">class</span> <span class="nc">Operator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Operator base class that is called on Field objects. </span>

<span class="sd">  Has addition and multiplication-related operations, and empty ___call___. </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To be overriden in subclasses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">None</span> 

  <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power: repeated multiplication.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Negative: multiplication by -1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FloatMul</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span>

  <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="n">Operator</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span> <span class="o">|</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FloatMul"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.FloatMul">[docs]</a><span class="k">class</span> <span class="nc">FloatMul</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Operator that is initalized with a float, and multiplies a Field argument with that float on calling.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize float multiplication by assigning value attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">      F: (Field) to act on.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      Field that is arg Field times value attribute, a float.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">F</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</div>
<div class="viewcode-block" id="Add"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Add">[docs]</a><span class="k">class</span> <span class="nc">Add</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Operator for addition among Operator objects. </span>

<span class="sd">  Stores left and right Operator __init__ arguments, that will both act on Field __call__ argument and then added there.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes &quot;left&quot; and &quot;right&quot; Operator arguments, and stores them in attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">      F: (Field) to act on.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      Field: sum of &quot;left&quot; and &quot;right&quot; operator called on arg Field, or None if something went wrong.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">right_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">right_result</span><span class="p">:</span>
      <span class="n">left_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">left_result</span><span class="p">:</span>
        <span class="n">combined_value</span> <span class="o">=</span> <span class="n">left_result</span> <span class="o">+</span> <span class="n">right_result</span>
        <span class="k">return</span> <span class="n">combined_value</span>
    <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Mul"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Mul">[docs]</a><span class="k">class</span> <span class="nc">Mul</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Operator for multiplication among Operator objects.</span>


<span class="sd">  Stores left and right Operator __init__ arguments, that will both act on Field __call__ argument and then multiplied there.</span>
<span class="sd">  &quot;&quot;&quot;</span>


  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes &quot;left&quot; and &quot;right&quot; Operator arguments, and stores them in attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">      F: (Field) to act on.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      Field: product of &quot;left&quot; and &quot;right&quot; operator called on arg Field, or None if something went wrong.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">right_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">right_result</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">right_result</span><span class="p">)</span>
   
       
    <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="make_lin_form"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.make_lin_form">[docs]</a><span class="k">def</span> <span class="nf">make_lin_form</span><span class="p">(</span><span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; pass</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="k">return</span> <span class="k">lambda</span> <span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">Xi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Lazy"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Lazy">[docs]</a><span class="k">class</span> <span class="nc">Lazy</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Operator created with a function argument. The function yields an operator, and is called only in __call__, where an operator attribute is assigned to self with that return value. From then on, that operator will act on the __call__ Field argument.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">op_fctn</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fctn</span> <span class="o">=</span> <span class="n">op_fctn</span> 

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fctn</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Pick"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Pick">[docs]</a><span class="k">class</span> <span class="nc">Pick</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Constructed with argument Xi, picks the VField component with direction matching that Xi and returns it.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize Pick Operator.</span>

<span class="sd">    Args:</span>
<span class="sd">      Xi: (str) containing direction (e.g. &#39;X&#39;) compatible with direction attributes of VField members.</span>

<span class="sd">    Raises:</span>
<span class="sd">      TypeError if argument not Field or VField.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Xi</span>
     
  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">UU</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Picks matching VField.direction to self.ax in VField.</span>

<span class="sd">    Projection of vector field to an axis.</span>

<span class="sd">    Args:</span>
<span class="sd">      UU: (VField) to pick member from</span>

<span class="sd">    Returns:</span>
<span class="sd">      Field or None depending on success.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">UU</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">UU</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">UU</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">UU</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">U</span> <span class="ow">in</span> <span class="n">UU</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">U</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">U</span>
      <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Error in pick operator </span><span class="si">%s</span><span class="s"> on </span><span class="si">%s</span><span class="s">, argument must be Field or VField. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">U</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SetDirection"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.SetDirection">[docs]</a><span class="k">class</span> <span class="nc">SetDirection</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator class to set the direction on a Field to self.ax.</span>
<span class="sd">  &quot;&quot;&quot;</span>  

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize SetDirection class by assigning ax attribute (ax).</span>

<span class="sd">    Args:</span>
<span class="sd">      ax: (Ax) axis that calling this class will asign to Field __call__ argument </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Xi</span>
    <span class="k">return</span> 

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot; Assign direction to copy of Field.</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="LinScale"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.LinScale">[docs]</a><span class="k">class</span> <span class="nc">LinScale</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator class to apply a 1D linear transformation to each element of a Field.</span>

<span class="sd">  Example:</span>

<span class="sd">  kelvin2c = ops.LinScale(1.,zero_kelvin,&#39;C&#39;); to convert Kelvin to C</span>
<span class="sd"> </span>
<span class="sd">  &quot;&quot;&quot;</span>  

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize slope a and additive constant b.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
    <span class="k">return</span> 

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot; Apply linear transformation a*F.value+b</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="StrInAttr"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.StrInAttr">[docs]</a><span class="k">class</span> <span class="nc">StrInAttr</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator class to check whether a string is in an attribute of a call argument field.</span>

<span class="sd">  Example:</span>

<span class="sd">  CheckTemp = StrInAttr(&#39;temperature&#39;,&#39;long_name&#39;)</span>
<span class="sd"> </span>
<span class="sd">  &quot;&quot;&quot;</span>  

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="p">,</span><span class="n">attr</span><span class="o">=</span><span class="s">&#39;long_name&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize attribute attr to be searched using string. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span>
    <span class="k">return</span> 

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot; search attr using call argument string</span>
<span class="sd">     &quot;&quot;&quot;</span>
     
     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)):</span>
       <span class="k">return</span> <span class="n">F</span>
     <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="bp">None</span>

     
</div>
<div class="viewcode-block" id="Innprod"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Innprod">[docs]</a><span class="k">class</span> <span class="nc">Innprod</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Inner product on two (V)Fields. </span>

<span class="sd">  Both fields must be in same linear space: their direction must match up to a permutation. Can be extended later to include non-trivial inner products.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  
  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce inner product of two (V)Fields. </span>

<span class="sd">    The product of two Field objects yields normal field multiplication. </span>
<span class="sd">    Multiplying two VField objects requires multiplicants to be of equal length and have the same direction attributes up to a permutation (e.g. X*Y vs Y*X is ok).</span>

<span class="sd">    Args:</span>
<span class="sd">      left: (Fiel or VField). left multiplicant</span>
<span class="sd">      right: (Fiel or VField). right multiplicant</span>

<span class="sd">    Returns: </span>
<span class="sd">      A Field containing the sum of the matching products.</span>

<span class="sd">    Raises:</span>
<span class="sd">      ValueError if VFields are not in same linear space (directions don&#39;t match up to permutation). </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">left</span><span class="o">*</span><span class="n">right</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">):</span>

      <span class="k">if</span> <span class="n">find_perm</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">direction</span><span class="p">(),</span><span class="n">right</span><span class="o">.</span><span class="n">direction</span><span class="p">()):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">left</span><span class="o">*</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">innersum</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Error in inner product </span><span class="si">%s</span><span class="s"> * </span><span class="si">%s</span><span class="s">, must be in same space. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Error in inner product </span><span class="si">%s</span><span class="s"> * </span><span class="si">%s</span><span class="s">, must be of equal length &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Der"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Der">[docs]</a><span class="k">class</span> <span class="nc">Der</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Directional derivative Operator.</span>

<span class="sd">  Attributes:</span>
<span class="sd">    ax: (Ax) axis in which direction __call__ will take the derivative. </span>

<span class="sd">  Example:</span>

<span class="sd">    &gt;&gt;&gt; ddX = sg.Der(X) # create Operator that would take X-derivative on Field args</span>
<span class="sd">    &gt;&gt;&gt; ddY = sg.Der(Y) # similar</span>
<span class="sd">    &gt;&gt;&gt; ddXddY = ddX*ddY  # create composite operator</span>
<span class="sd">    &gt;&gt;&gt; ddXddY(F) # differentiation in X direction following differentiation in Y</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize Der Operator by assigning Ax object from Xi arg. to ax attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Xi</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Call der method of (V)Field argument using self.ax as ax argument.</span>

<span class="sd">    This will then call the Ax.der method on VF, which in turn calls the Gr.der method. That will take care of any Coord-dependencies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">vF</span><span class="o">.</span><span class="n">der</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
 
</div>
<div class="viewcode-block" id="Integ"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Integ">[docs]</a><span class="k">class</span> <span class="nc">Integ</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Compute total integral in ax direction. </span>

<span class="sd">  Attributes:</span>
<span class="sd">    ax: (Ax) axis direction in which to integrate.</span>
<span class="sd">   </span>
<span class="sd">  See also:</span>
<span class="sd">    vsum method.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the Integ Operator by assigning ax attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      ax: (Ax) axis to integrate over.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Xi</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the Integ Operator by assigning ax attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      vF: (Field or VField) to integrate.</span>

<span class="sd">    Returns:</span>
<span class="sd">      vsum method called on vF.</span>

<span class="sd">    Raises:</span>
<span class="sd">      TypeError </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">vsum</span><span class="p">(</span><span class="n">vF</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">VField</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">vsum</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vF</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Error in </span><span class="si">%s</span><span class="s"> - integration of </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">vF</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mean"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Mean">[docs]</a><span class="k">class</span> <span class="nc">Mean</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Calculate mean of (V)Field object using stored Ax object.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize Mean Operator.</span>
<span class="sd">  </span>
<span class="sd">    Args:</span>
<span class="sd">      Xi: (Ax or Gr) axis or grid along which to take mean when calling __call__</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Xi</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize Mean Operator.</span>
<span class="sd">  </span>
<span class="sd">    Args:</span>
<span class="sd">      vF: (Field or VField) to take mean of </span>

<span class="sd">    Returns:</span>
<span class="sd">      Mean of Field.</span>

<span class="sd">    Raises:</span>
<span class="sd">      TypeError </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c"># we need to use / method instead of vF.mean for now, as vF.mean calls the vol method that can&#39;t deal with artificial non-spatial type Coord objects (e.g. &#39;experiment axis&#39;).</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">vF</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">VField</span><span class="p">([</span><span class="bp">self</span><span class="o">*</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vF</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error in taking </span><span class="si">%s</span><span class="s"> - primitive of </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">vF</span><span class="p">))</span>    


  <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multiplication of Mean object with other Operator.</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="n">Mean</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">Mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Prim"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Prim">[docs]</a><span class="k">class</span> <span class="nc">Prim</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Take primitive (antiderivative) of (V)Field along axis.</span>

<span class="sd">  Calls vcumsum.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize Prim Operator by specifying ax attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      Xi: (Ax) along which to take primitive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Xi</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call vF.vcumsum on self.Xi.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vF</span><span class="o">.</span><span class="n">vcumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FieldMul"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.FieldMul">[docs]</a><span class="k">class</span> <span class="nc">FieldMul</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator storing a Field and multiplying (V)Field argument with that Field when called.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize FieldMul Operator by storing Field in F attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multiply (V)Field with self.F and return product (V)Field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="n">vF</span>
</div>
<div class="viewcode-block" id="Sum"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Sum">[docs]</a><span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator adding the vector components of a VField and returning the resulting Field.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">      vF: (Field or VField) to take inner sum of.</span>

<span class="sd">    Returns:</span>
<span class="sd">      Field containing sum.</span>

<span class="sd">    Raises:</span>
<span class="sd">      TypeError if argument other than (V)Field</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">vF</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
      <span class="n">result</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="n">vF</span><span class="p">)</span>
      <span class="n">result</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">ID</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">result</span>

    <span class="k">else</span><span class="p">:</span>

      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Error in Sum </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="n">vF</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Slice"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Slice">[docs]</a><span class="k">class</span> <span class="nc">Slice</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Slice Operator storing tuple of Coord vs slice object pairs to slice (V)Field arguments with on __call__.</span>

<span class="sd">  Example of slice: (X,10,Y,5)</span>

<span class="sd">  Attributes:</span>
<span class="sd">    tup: (tuple of Coord vs slice objects) to slice Field with</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initialize Slice Operator.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      tup (tuple of Coord vs slice obj pairs).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tup</span> <span class="o">=</span> <span class="n">tup</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vF</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Slice (V)Field argument with self.tup attribute.</span>

<span class="sd">   Args:</span>
<span class="sd">     vF: (Field or VField)</span>
<span class="sd">   </span>
<span class="sd">   Returns:</span>
<span class="sd">     Sliced (V)Field</span>

<span class="sd">   Raises:</span>
<span class="sd">     TypeError</span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">vF</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tup</span><span class="p">])</span>
   <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">VField</span><span class="p">([</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tup</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vF</span><span class="p">])</span>
   <span class="k">else</span><span class="p">:</span>

      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Error in Slice </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="n">vF</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Identity"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Identity">[docs]</a><span class="k">class</span> <span class="nc">Identity</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator representing the identity. </span>

<span class="sd">  No change upon __call__</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return argument as is.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vF</span>





</div>
<div class="viewcode-block" id="PickBasin"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.PickBasin">[docs]</a><span class="k">class</span> <span class="nc">PickBasin</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Slice Operator storing tuple of Coord vs slice object pairs to slice (V)Field arguments with on __call__.</span>

<span class="sd">  Example of slice: (X,10,Y,5)</span>

<span class="sd">  Attributes:</span>
<span class="sd">    tup: (tuple of Coord vs slice objects) to slice Field with</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">south_index</span><span class="o">=</span><span class="mi">33</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initialize basin pick Operator. Picks basin using floodfill</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      node: x,y coords of point inside basin in form (X,85,Y,30)</span>
<span class="sd">      south_index: take everything north of this index</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">south_index</span> <span class="o">=</span> <span class="n">south_index</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vF</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Slice (V)Field argument with self.tup attribute.</span>

<span class="sd">   Args:</span>
<span class="sd">     vF: (Field or VField)</span>
<span class="sd">   </span>
<span class="sd">   Returns:</span>
<span class="sd">     Sliced (V)Field</span>

<span class="sd">   Raises:</span>
<span class="sd">     TypeError</span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">vF</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">south_index</span><span class="p">:]</span><span class="o">.</span><span class="n">maskout</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>

   <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
     <span class="k">return</span>
<span class="c">#     return VField([squeeze(e[self.tup]) for e in vF])</span>
   <span class="k">else</span><span class="p">:</span>

      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Error in Slice </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="n">vF</span><span class="p">)</span>
















<span class="c"># define an instance of the identity:</span></div>
<span class="n">nop</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">();</span>

<div class="viewcode-block" id="If"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.If">[docs]</a><span class="k">class</span> <span class="nc">If</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;If Operator as in If then.</span>

<span class="sd">  The state of the system is defined by the Field(s) vF. Therefore, the condition can be internal to the call function and must be defined in terms of vF (e.g. &#39;len(vF.grid) == 3&#39;). </span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Cond_Op</span><span class="p">,</span> <span class="n">True_Op</span><span class="p">,</span> <span class="n">Else_Op</span> <span class="o">=</span> <span class="n">nop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize If Operator by storing args in attributes. </span>

<span class="sd">    Args:</span>
<span class="sd">      Cond_Op: (Operator): to apply to (V)Field argument</span>
<span class="sd">      True_Op: (Operator): to apply if this yields a different result</span>
<span class="sd">      Else_Op: (Operator): to apply if (V)Field remains unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">Cond_Op</span> <span class="o">=</span> <span class="n">Cond_Op</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">True_Op</span> <span class="o">=</span> <span class="n">True_Op</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Else_Op</span> <span class="o">=</span> <span class="n">Else_Op</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Perform if-then depending on (V)Field argument.</span>

<span class="sd">   If Cond_Op applied to vF yields the same result (as vF), apply True_Op. Apply Else_Op otherwise.</span>

<span class="sd">   Raises: TypeError</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span> <span class="o">|</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
     
     <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cond_Op</span><span class="p">(</span><span class="n">vF</span><span class="p">)</span>

     <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">vF</span><span class="p">:</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">True_Op</span><span class="p">(</span><span class="n">vF</span><span class="p">)</span>
     <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Else_Op</span><span class="p">(</span><span class="n">vF</span><span class="p">)</span>

   <span class="k">else</span><span class="p">:</span>

      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Error in If </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="n">vF</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="While"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.While">[docs]</a><span class="k">class</span> <span class="nc">While</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Similar to If Operator</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">True_Op</span><span class="p">,</span><span class="n">Cond_Op</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Similar to If Operator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">Cond_Op</span> <span class="o">=</span> <span class="n">Cond_Op</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">IF</span> <span class="o">=</span> <span class="n">If</span><span class="p">(</span><span class="n">Cond_Op</span> <span class="o">=</span> <span class="n">Cond_Op</span><span class="p">,</span><span class="n">True_Op</span> <span class="o">=</span> <span class="n">True_Op</span><span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Similar to If Operator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">Field</span><span class="p">)</span> <span class="o">|</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">vF</span><span class="p">,</span><span class="n">VField</span><span class="p">):</span>
     
      <span class="n">prev_result</span> <span class="o">=</span> <span class="n">vF</span>
      <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IF</span><span class="o">*</span><span class="n">prev_result</span>

      <span class="k">while</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">prev_result</span><span class="p">:</span>
        <span class="n">prev_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IF</span><span class="o">*</span><span class="n">result</span>

      <span class="k">return</span> <span class="n">result</span>       

    <span class="k">else</span><span class="p">:</span>

      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error in While </span><span class="si">%s</span><span class="s">, argument must be Field or VField &#39;</span> <span class="o">%</span> <span class="n">vF</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Try"><a class="viewcode-back" href="../../spacegrids.html#spacegrids.ops.Try">[docs]</a><span class="k">class</span> <span class="nc">Try</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Operator storing an Operator that is called with except on (V)Field argument in __call__ </span>

<span class="sd">  If successful, return result, otherwise return original (V)Field argument.</span>

<span class="sd">  Similar to If Operator</span>
<span class="sd">  &quot;&quot;&quot;</span>


  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize Try object by assigning Op Operator argument to attribute Op.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Op</span> <span class="o">=</span> <span class="n">Op</span>

  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Try calling self.Op on vF (V)Field argument and return result.</span>
<span class="sd"> </span>
<span class="sd">    If this fails, return original vF</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Op</span><span class="o">*</span><span class="n">vF</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">vF</span>

    <span class="k">return</span> <span class="n">result</span>
</div>
<span class="n">sia_temp</span> <span class="o">=</span> <span class="n">StrInAttr</span><span class="p">(</span><span class="s">&#39;temperature&#39;</span><span class="p">)</span>
<span class="n">sia_K</span> <span class="o">=</span> <span class="n">StrInAttr</span><span class="p">(</span><span class="s">&#39;K&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">)</span>

<span class="n">kelvin2c</span> <span class="o">=</span> <span class="n">LinScale</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="n">zero_kelvin</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">)</span>

<span class="n">kelvin2c</span> <span class="o">=</span> <span class="n">If</span><span class="p">(</span><span class="n">sia_K</span><span class="o">*</span><span class="n">sia_temp</span><span class="p">,</span><span class="n">kelvin2c</span><span class="p">)</span>



<span class="c"># define an instance of Innprod:</span>
<span class="n">dot</span> <span class="o">=</span> <span class="n">Innprod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">spacegrids  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Willem Sijp.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>